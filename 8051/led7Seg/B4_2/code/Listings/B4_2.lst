C51 COMPILER V9.60.0.0   B4_2                                                              05/11/2022 11:31:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE B4_2
OBJECT MODULE PLACED IN .\Objects\B4_2.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE B4_2.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\B4_2
                    -.lst) TABS(2) OBJECT(.\Objects\B4_2.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          
   4          //led single
   5          #define Led P2
   6          
   7          //led 7seg anode, power
   8          #define Led_7Seg P0 
   9          
  10          #define Control_Led1 P3_4 
  11          #define Control_Led2 P3_5 
  12          #define Control_Led3 P3_6 
  13          #define Control_Led4 P3_7 
  14          
  15          //button
  16          #define b1 P1_0
  17          #define b2 P1_1
  18          #define b3 P1_2
  19          
  20          int status=0;
  21          //code led 7 seg
  22          unsigned char Number[] = {0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};
  23          
  24          //config system
  25          void config();
  26          
  27          void delay_ms(unsigned int);
  28          
  29          //led single
  30          void sangDon();
  31          
  32          
  33          //led 7seg
  34          void display_number_define(unsigned int);
  35          void display_number_from_x_to_y(unsigned int x, unsigned int y);
  36          
  37          //button
  38          void button();
  39          
  40          void turnOff();
  41          
  42          //interrupt
  43          void config_EXT();
  44          
  45          void main()
  46          {
  47   1        config();
  48   1        
  49   1        while(1)
  50   1        {
  51   2          button();
  52   2        }
  53   1      }
  54          
C51 COMPILER V9.60.0.0   B4_2                                                              05/11/2022 11:31:57 PAGE 2   

  55          void config()
  56          {
  57   1        turnOff();
  58   1        config_EXT();
  59   1      }
  60            
  61          void delay_ms(unsigned int t){
  62   1        unsigned int x, y;
  63   1        
  64   1        for(x=0; x<t; x++)
  65   1          for(y=0; y<123; y++);
  66   1      }
  67          
  68          void sangDon()
  69          {
  70   1        unsigned int TTCD, TTDC;//TTCD la trang thai co dinh, TTDC la trang thai dich chuyen
  71   1        int i, j;
  72   1        
  73   1        TTCD = 0;
  74   1        for(i=8; i>0; i--)
  75   1        {
  76   2          TTDC = 0x01;
  77   2          for(j=0; j<i; j++)
  78   2          {     
  79   3            if(status != 1)
  80   3              break;
  81   3            
  82   3            Led = TTCD|TTDC;
  83   3            delay_ms(200);
  84   3            TTDC = TTDC<<1;
  85   3          }
  86   2          TTCD = Led;
  87   2        }
  88   1        
  89   1        Led  =  0x00;
  90   1      }
  91          
  92          void display_number_define(unsigned int number)
  93          {
  94   1        unsigned char nghin, tram, chuc, dvi;
  95   1        
  96   1        nghin = number/1000;
  97   1        tram = (number%1000)/100;
  98   1        chuc = (number%100)/10;
  99   1        dvi = number%10;
 100   1      
 101   1        Led_7Seg = Number[nghin];
 102   1        Control_Led1 = 0;
 103   1        delay_ms(2);
 104   1        Control_Led1 = 1;
 105   1        
 106   1        Led_7Seg = Number[tram];
 107   1        Control_Led2 = 0;
 108   1        delay_ms(2);
 109   1        Control_Led2 = 1;
 110   1        
 111   1        Led_7Seg = Number[chuc];
 112   1        Control_Led3 = 0;
 113   1        delay_ms(2);
 114   1        Control_Led3 = 1;
 115   1        
 116   1        Led_7Seg = Number[dvi];
C51 COMPILER V9.60.0.0   B4_2                                                              05/11/2022 11:31:57 PAGE 3   

 117   1        Control_Led4 = 0;
 118   1        delay_ms(2);
 119   1        Control_Led4 = 1;
 120   1      }
 121          
 122          /*
 123          moi 1s se tang so len 1 lan
 124          
 125          ma trong "ham display_number_define" co delay 8 ms
 126          
 127          -->thoi gian vong lap i = 1000ms/8ms = 125 lan
 128          */
 129          void display_number_from_x_to_y(unsigned int x, unsigned int y)
 130          {
 131   1        unsigned int i, k;
 132   1        
 133   1        if(x<y)
 134   1        {
 135   2          for(k=x; k<=y; k++)
 136   2          {
 137   3            if(status != 2)
 138   3              break;
 139   3            
 140   3            for(i=0; i<125; i++)
 141   3              display_number_define(k);
 142   3            
 143   3          }
 144   2        }
 145   1        else if(x>y)
 146   1        {
 147   2          for(k=x; k>=y; k--)
 148   2          {
 149   3            for(i=0; i<125; i++)
 150   3              display_number_define(k);
 151   3            if(status != 2)
 152   3              break;
 153   3          }
 154   2        }
 155   1      }
 156          
 157          void button()
 158          {
 159   1          if(b1 == 0)
 160   1            status = 1;
 161   1          
 162   1          
 163   1          if(status == 1)
 164   1              sangDon();
 165   1          else if(status == 2)
 166   1            display_number_from_x_to_y(0, 9);
 167   1          else if(status == 0)
 168   1            turnOff();
 169   1      }
 170          
 171          void turnOff()
 172          {
 173   1        //turn off all led 7 seg
 174   1        Led_7Seg = 0xFF;
 175   1        
 176   1        //turn off all led single
 177   1        Led = 0x00;
 178   1      }
C51 COMPILER V9.60.0.0   B4_2                                                              05/11/2022 11:31:57 PAGE 4   

 179          
 180          //cau hinh ngat ngoai
 181          void config_EXT()
 182          {
 183   1        EX0=1;
 184   1        EX1=1;
 185   1        
 186   1        IT0=1;
 187   1        IT1=1;
 188   1        
 189   1        EA=1;
 190   1      }
 191          
 192          void EX0_ISR() interrupt 0
 193          {
 194   1        status = 2;
 195   1      }
 196          
 197          void EX1_ISR() interrupt 2
 198          {
 199   1        status = 0;
 200   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    524    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
