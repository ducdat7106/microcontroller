C51 COMPILER V9.60.0.0   TIMER0                                                            05/08/2022 10:30:11 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Lib\timer0.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Main;.\Lib) DEBUG OBJECTE
                    -XTEND PRINT(.\Listings\timer0.lst) TABS(2) OBJECT(.\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          
   3          
   4          /*
   5          Mode 1, timer0 16bit
   6          
   7          12MHz/12 = 1MHz = f 
   8          
   9          T=1/1MHz = 1us
  10          
  11          16bit = 2^16 - 1 = 65535
  12          
  13          1    lenh   1us
  14          
  15          1000 lenh   1000us
  16          
  17          65535 lenh  65535us  --> sau 65535 lenh timer se sinh ngat 1 lan
  18          
  19          de timer sinh ngat moi 1ms 1 lan ==> 1000us --> can 1000 lenh
  20          
  21          -->65535-1000 + 1 = 64536 = TL0 + TH0
  22          */
  23          void timer0_init()
  24          {
  25   1        #if mode == 1 //1000us = 1ms will set flag interrupt 
  26   1        
  27   1          // Chon mode 1 cho T0
  28   1          TMOD &= 0xF0; // Xoa cac bit dieu khien thanh ghi TMOD cua T0
  29   1          TMOD |= 0x01; // Cho mode 1 cho timer0
  30   1          
  31   1          TL0 = 0x18; //64536 = FC18 = 65535-1000+1 --> 1ms sinh ngat 1 lan
  32   1          TH0 = 0xFC;
  33   1          
  34   1          ET0 = 1;         // Enable Timer0 interrupts
  35   1          EA  = 1;         // Global interrupt enable
  36   1          
  37   1          TF0 = 0;         //clear flag interrupt
  38   1          
  39   1          TR0 = 1;         // Start Timer 0
  40   1        
  41   1        #elif mode == 2 //250us auto reloading time
                
                  // Chon mode 2cho T0
                  TMOD &= 0xF0; // Xoa cac bit dieu khien thanh ghi TMOD cua T0 
                  TMOD |= 0x02; // Cho mode 1 cho timer0
                  
                  TH0 = 0x05;      // 250 usec reloading time
                  TL0 = 0x05;      // First time value
                  
                  ET0 = 1;         // Enable Timer0 interrupts
                  EA  = 1;         // Global interrupt enable
                  
                  TF0 = 0;         //clear flag interrupt
                  
C51 COMPILER V9.60.0.0   TIMER0                                                            05/08/2022 10:30:11 PAGE 2   

                  TR0 = 1;         // Start Timer 0
                  
                #endif
  58   1        
  59   1      }
  60          
  61          void timer0_ISR(void) interrupt 1   
  62          {
  63   1        #if mode == 1   //// It is called after every 1 ms
  64   1          //do thing
  65   1          do_thing_in_interrupt();
  66   1          
  67   1          //end do thing
  68   1        
  69   1          TF0 = 0;  // Clear the interrupt flag
  70   1        
  71   1          TL0 = 0x18;//unload value for timer0
  72   1          TH0 = 0xFC;
  73   1          
  74   1        #elif mode == 2 //// It is called after every 250 us
                  //do thing
                  xung_test = !xung_test;
                
                
                  //end do thing
                
                  TF0 = 0;  // Clear the interrupt flag
                
                  //no unload value for timer0 so auto unload value
                
                #endif
  86   1      }
  87          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
