C51 COMPILER V9.60.0.0   TIMER0                                                            05/10/2022 08:24:41 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Lib\timer0.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Main;.\Lib) DEBUG OBJECTE
                    -XTEND PRINT(.\Listings\timer0.lst) TABS(2) OBJECT(.\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          
   3          void timer0_init()
   4          {
   5   1        #if mode == 1 //1000us = 1ms will set flag interrupt 
   6   1        
   7   1          // Chon mode 1 cho T0
   8   1          TMOD &= 0xF0; // Xoa cac bit dieu khien thanh ghi TMOD cua T0
   9   1          TMOD |= 0x01; // Cho mode 1 cho timer0
  10   1          
  11   1          TL0 = 0x18; //64536 = FC18 = 65535-1000+1 --> 1ms sinh ngat 1 lan
  12   1          TH0 = 0xFC; //TL = 18, TH = FC;
  13   1          
  14   1          ET0 = 1;         // Enable Timer0 interrupts
  15   1          EA  = 1;         // Global interrupt enable
  16   1          
  17   1          TF0 = 0;         //clear flag interrupt
  18   1          
  19   1          TR0 = 1;         // Start Timer 0
  20   1        
  21   1        #elif mode == 2 //250us auto reloading time
                
                  // Chon mode 2cho T0
                  TMOD &= 0xF0; // Xoa cac bit dieu khien thanh ghi TMOD cua T0 
                  TMOD |= 0x02; // Cho mode 1 cho timer0
                  
                  TH0 = 0x05;      // 250 usec reloading time
                  TL0 = 0x05;      // First time value
                  
                  ET0 = 1;         // Enable Timer0 interrupts
                  EA  = 1;         // Global interrupt enable
                  
                  TF0 = 0;         //clear flag interrupt
                  
                  //TR0 = 1;         // Start Timer 0
                  
                #endif
  38   1        
  39   1      }
  40          
  41          void timer0_ISR(void) interrupt 1   
  42          {
  43   1        #if mode == 1   //// It is called after every 1 ms
  44   1          //do thing
  45   1          do_thing_in_interrupt();
  46   1          
  47   1          //end do thing
  48   1        
  49   1          TF0 = 0;  // Clear the interrupt flag
  50   1        
  51   1          TL0 = 0x18;//unload value for timer0
  52   1          TH0 = 0xFC;
  53   1          
  54   1        #elif mode == 2 //// It is called after every 250 us
C51 COMPILER V9.60.0.0   TIMER0                                                            05/10/2022 08:24:41 PAGE 2   

                  //do thing  
                  do_thing_in_interrupt();
                  //end do thing
                
                  TF0 = 0;  // Clear the interrupt flag
                
                  //no unload value for timer0 so auto unload value
                
                #endif
  64   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
